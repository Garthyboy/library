<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elite Crime & Espionage Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --bg-deep: #0a0a0c;
      --card-bg: #16161a;
      --accent: #e50914;
      --watched: #10b981;
    }
    body {
      background-color: var(--bg-deep);
      color: #e5e7eb;
      font-family: 'Inter', sans-serif;
    }
    .show-card {
      background: var(--card-bg);
      border: 1px solid #2d2d35;
      transition: transform 0.2s ease, border-color 0.2s ease;
    }
    .show-card:hover {
      border-color: var(--accent);
      transform: translateY(-4px);
    }
    .watched-badge {
      background-color: var(--watched);
      color: white;
    }
    .tag {
      background: #2d2d35;
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 4px;
      text-transform: uppercase;
    }
    .trailer-thumb {
      aspect-ratio: 16 / 9;
      background-size: cover;
      background-position: center;
      background-color: #111;
    }
  </style>
</head>
<body class="p-4 md:p-8">

  <header class="max-w-6xl mx-auto mb-12 border-b border-gray-800 pb-8">
    <div class="flex flex-col md:flex-row md:justify-between md:items-end gap-4">
      <div>
        <h1 class="text-4xl md:text-5xl font-black tracking-tighter text-white mb-2 italic">THE LIBRARY.</h1>
        <p class="text-gray-400 text-lg">Curated Intelligence & High-Stakes European Crime.</p>
      </div>
      <div class="text-right">
        <p class="text-[10px] font-mono text-zinc-600 uppercase">Storage</p>
        <p id="storage-status" class="text-xs font-mono text-zinc-400">Local (this browser)</p>
      </div>
    </div>
    <div class="flex flex-wrap gap-4 mt-6">
      <span class="flex items-center gap-2 text-sm">
        <div id="legend-watched-dot" class="w-3 h-3 rounded-full bg-gray-600"></div>
        <span id="legend-watched-label">Watched</span>
      </span>
      <span class="flex items-center gap-2 text-sm">
        <div id="legend-unseen-dot" class="w-3 h-3 rounded-full bg-gray-600"></div>
        <span id="legend-unseen-label">Unseen</span>
      </span>
    </div>
  </header>

  <div class="max-w-6xl mx-auto mb-8 flex flex-wrap gap-2">
    <button onclick="window.filterContent('all')" id="btn-all" class="px-4 py-2 bg-white text-black font-bold rounded-md hover:bg-gray-200 transition">All Ops</button>
    <button onclick="window.filterContent('unseen')" id="btn-unseen" class="px-4 py-2 bg-zinc-800 text-white font-bold rounded-md hover:bg-zinc-700 transition">Unseen</button>
    <button onclick="window.filterContent('upcoming')" id="btn-upcoming" class="px-4 py-2 bg-zinc-800 text-white font-bold rounded-md hover:bg-zinc-700 transition">2026 Schedule</button>
    <button onclick="window.resetLibrary()" id="btn-reset" class="ml-auto px-4 py-2 bg-zinc-900 text-white font-bold rounded-md border border-zinc-700 hover:bg-zinc-800">Reset (local)</button>
  </div>

  <main id="libraryGrid" class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></main>

  <script>
    const STORAGE_KEY = "elite_crime_library_v1";

    const slugify = (str) => String(str || "").toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)+/g, "");
    const clampPct = (n) => (typeof n !== "number" || Number.isNaN(n)) ? null : Math.max(0, Math.min(100, Math.round(n)));

    const initialShows = [
        { name: "4 Blocks", about: "A German powerhouse about a Lebanese crime family in Berlin. It mirrors Kin's focus on family loyalty vs. the business of crime.", watched: false, type: "Mafia", trailer: "https://www.youtube.com/watch?v=HZQFjQPyD0o" },
        { name: "Betrayal (ITV)", about: "Heavy-hitting British espionage thriller starring Shaun Evans. Perfect for fans of Homeland; focuses on high-stakes intelligence operation.", watched: false, type: "Espionage", trailer: "https://www.youtube.com/watch?v=NNtxHA1Lq9k" },
        { name: "Blinded by the Lights", about: "Polish series with visual style identical to ZeroZeroZero. Follows a cocaine dealer in Warsaw whose life unravels over one chaotic week.", watched: false, type: "Crime", trailer: "https://www.youtube.com/watch?v=CVOaVn6iHkg" },
        { name: "Blood Coast (Pax Massilia)", about: "Set in Marseille. Violent, high-paced, and captures the same 'uncontrollable city' vibe as Naples in Gomorrah.", watched: false, type: "Action", trailer: "https://www.youtube.com/watch?v=nEP2but7fAs" },
        { name: "Caliphate (Kalifat)", about: "A Swedish thriller that is one of the most intense depictions of radicalisation and counter-terrorism on television.", watched: false, type: "Thriller", trailer: "https://www.youtube.com/watch?v=UhXOhWVTpf8" },
        { name: "Fauda", about: "Real IDF experience, breathless tactical operations and the human cost of the Israeli-Palestinian conflict.", watched: true, type: "Tactical", trailer: "https://www.youtube.com/watch?v=wf_-X6ocMHI" },
        { name: "Gomorrah", about: "The ultimate hyper-realist mafia saga. It ignores the glamour to show the rotting nature of power in Naples.", watched: true, type: "Mafia", trailer: "https://www.youtube.com/watch?v=-4QORgagblU" },
        { name: "Kin", about: "Slow-burn Irish drama focusing on the unbreakable but suffocating bonds of a Dublin crime family.", watched: true, type: "Crime", trailer: "https://www.youtube.com/watch?v=_byGxUym7HQ" },
        { name: "Slow Horses", about: "Cynical take on British intelligence following a group of MI5 'rejects' who find themselves at the centre of conspiracies.", watched: false, type: "Spy", trailer: "https://www.youtube.com/watch?v=O9ZJChzPn0U" },
        { name: "Suburra Blood on Rome", about: "Italian thriller focusing on the intersection of the mafia, corrupt politicians, and the Vatican.", watched: true, type: "Mafia", trailer: "https://www.youtube.com/watch?v=AYwpxrt7ZLA" },
        { name: "The Spy", about: "Sacha Baron Cohen portrays Eli Cohen in this tense, heartbreaking true story of a Mossad agent in Syria.", watched: true, type: "Spy", trailer: "https://www.youtube.com/watch?v=5UijUOy0MmE&t=6s" },
        { name: "ZeroZeroZero", about: "A global look at the logistics of crime, following a single shipment across three continents.", watched: true, type: "Cartel", trailer: "https://www.youtube.com/watch?v=gUKUcRCFG0c" }
    ];

    let currentFilter = "all", shows = [], editingId = null, playingId = null;
    const expandedIds = new Set();
    window.editDraft = {};

    function loadShows() {
      const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "null");
      return (Array.isArray(saved) && saved.length) ? saved.map(normalizeShow) : initialShows.map(normalizeShow);
    }

    function saveShows(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      const el = document.getElementById("storage-status");
      if (el) {
        el.textContent = "Saved locally";
        setTimeout(() => el.textContent = "Local (this browser)", 900);
      }
    }

    function normalizeShow(s) {
      const name = String(s?.name ?? "");
      return {
        id: String(s?.id ?? slugify(name)),
        name,
        about: String(s?.about ?? ""),
        watched: Boolean(s?.watched),
        type: String(s?.type ?? ""),
        trailer: String(s?.trailer ?? ""),
        noShitPct: typeof s?.noShitPct === "number" ? clampPct(s.noShitPct) : null,
        rtPct: typeof s?.rtPct === "number" ? clampPct(s.rtPct) : null
      };
    }

    function getYTId(url) { return url?.split("v=")[1]?.split("&")[0]; }
    function getYTThumb(url) {
      const id = getYTId(url);
      return id ? `https://img.youtube.com/vi/${id}/hqdefault.jpg` : "https://images.unsplash.com/photo-1533422902779-afd35862846a?auto=format&fit=crop&w=800&q=80";
    }
    function getYTEmbed(url) {
      const id = getYTId(url);
      return id ? `https://www.youtube.com/embed/${id}?autoplay=1&rel=0` : null;
    }

    function updateLegend(filter) {
      const w = document.getElementById("legend-watched-dot"), u = document.getElementById("legend-unseen-dot");
      if (!w || !u) return;
      const on = "bg-green-500", off = "bg-gray-600";
      w.classList.remove(on, off); u.classList.remove(on, off);
      if (filter === "unseen") { w.classList.add(off); u.classList.add(on); }
      else if (filter === "upcoming") { w.classList.add(off); u.classList.add(off); }
      else { w.classList.add(on); u.classList.add(on); }
    }

    window.toggleWatched = (id) => {
      const show = shows.find(s => s.id === id);
      if (show) { show.watched = !show.watched; saveShows(shows); renderLibrary(currentFilter); }
    };

    window.startEdit = (id) => {
      editingId = id;
      const show = shows.find(s => s.id === id);
      window.editDraft = { noShitPct: show.noShitPct, rtPct: show.rtPct };
      renderLibrary(currentFilter);
    };

    window.cancelEdit = () => { editingId = null; window.editDraft = {}; renderLibrary(currentFilter); };

    window.saveEdit = (id) => {
      const show = shows.find(s => s.id === id);
      if (show) {
        show.noShitPct = clampPct(Number(window.editDraft.noShitPct));
        show.rtPct = clampPct(Number(window.editDraft.rtPct));
        saveShows(shows);
      }
      editingId = null; renderLibrary(currentFilter);
    };

    window.toggleAbout = (id) => { expandedIds.has(id) ? expandedIds.delete(id) : expandedIds.add(id); renderLibrary(currentFilter); };
    window.filterContent = (f) => { playingId = null; currentFilter = f; renderLibrary(f); };
    window.resetLibrary = () => { if(confirm("Reset local library?")) { localStorage.removeItem(STORAGE_KEY); shows = initialShows.map(normalizeShow); renderLibrary(currentFilter); } };

    function renderLibrary(filter = "all") {
      updateLegend(filter);
      const grid = document.getElementById("libraryGrid");
      grid.innerHTML = "";

      ["all", "unseen", "upcoming"].forEach(f => {
        const btn = document.getElementById(`btn-${f}`);
        if (btn) btn.className = `px-4 py-2 font-bold rounded-md transition ${f === filter ? 'bg-white text-black' : 'bg-zinc-800 text-white hover:bg-zinc-700'}`;
      });

      if (filter === "upcoming") {
        const upcoming = [
          { name: "4 Blocks Zero", date: "Mid-2026", about: "Prequel following how the Hamadi family became Berlin's most powerful clan.", source: "HBO / Warner" },
          { name: "Fauda (Season 5)", date: "Mid-2026", about: "Picks up two years after Oct 7th aftermath.", source: "Netflix" }
        ];
        upcoming.forEach(item => {
          grid.innerHTML += `<div class="show-card rounded-xl overflow-hidden border-l-4" style="border-left-color: var(--accent)"><div class="p-6"><div class="flex justify-between items-start mb-4"><span class="bg-red-900/40 text-red-400 px-3 py-1 rounded-full text-xs font-bold uppercase">${item.date}</span><span class="text-xs text-gray-500 font-mono">${item.source}</span></div><h3 class="text-2xl font-bold text-white mb-3">${item.name}</h3><p class="text-gray-400 text-sm leading-relaxed">${item.about}</p></div></div>`;
        });
        return;
      }

      shows.forEach(show => {
        if (filter === "unseen" && show.watched) return;
        const isEditing = editingId === show.id;
        grid.innerHTML += `
          <div class="show-card rounded-xl overflow-hidden group">
            <div class="trailer-thumb relative" style="background-image: url('${getYTThumb(show.trailer)}')">
              ${playingId === show.id ? `<iframe src="${getYTEmbed(show.trailer)}" class="absolute inset-0 w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><button onclick="playingId=null;renderLibrary(currentFilter)" class="absolute top-3 right-3 bg-black/60 text-white text-xs px-3 py-1 rounded-full">Close</button>` : `
                <div class="absolute inset-0 bg-black/50 group-hover:bg-black/30 transition-all"></div>
                ${show.watched ? `<div class="absolute top-3 right-3 watched-badge px-3 py-1 rounded-full text-[10px] font-bold uppercase">WATCHED</div>` : ""}
                <div class="absolute inset-0 flex items-center justify-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button onclick="playingId='${show.id}';renderLibrary(currentFilter)" class="w-14 h-14 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center border border-white/40 hover:bg-white/40 transition"><div class="w-0 h-0 border-t-[10px] border-t-transparent border-l-[14px] border-l-white border-b-[10px] border-b-transparent ml-1"></div></button>
                  <button onclick="window.toggleWatched('${show.id}')" class="w-12 h-12 bg-zinc-800/80 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 hover:bg-zinc-700 transition"><svg class="w-6 h-6" style="color: ${show.watched ? 'var(--watched)' : '#ffffff'}" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg></button>
                </div>
              `}
            </div>
            <div class="p-6">
              <span class="tag">${show.type}</span>
              <h3 class="text-xl font-bold text-white my-2 leading-tight">${show.name}</h3>
              <p class="text-gray-400 text-sm leading-relaxed ${expandedIds.has(show.id) ? '' : 'h-[60px] overflow-hidden'}">${show.about}</p>
              ${show.about.length > 200 ? `<button onclick="window.toggleAbout('${show.id}')" class="mt-2 text-[10px] font-mono uppercase text-zinc-400 hover:text-white">${expandedIds.has(show.id) ? 'Less' : 'More'}</button>` : ''}
              <div class="mt-4 text-xs font-mono text-zinc-400">
                ${isEditing ? `<div class="flex items-center gap-2"><input type="number" value="${show.noShitPct ?? ''}" oninput="window.editDraft.noShitPct=this.value" class="w-16 bg-zinc-900 border border-zinc-700 rounded px-1 text-white" placeholder="No Shit %" /><input type="number" value="${show.rtPct ?? ''}" oninput="window.editDraft.rtPct=this.value" class="w-16 bg-zinc-900 border border-zinc-700 rounded px-1 text-white" placeholder="RT %" /><button onclick="window.saveEdit('${show.id}')" class="text-green-400">Save</button><button onclick="window.cancelEdit()" class="text-zinc-500">Cancel</button></div>` : `
                  <span>No Shit: ${show.noShitPct ?? '—'}%</span> <span class="ml-3">RT: ${show.rtPct ?? '—'}%</span>
                  <button onclick="window.startEdit('${show.id}')" class="ml-4 hover:text-white">Edit</button>
                `}
              </div>
            </div>
          </div>`;
      });
    }

    shows = loadShows();
    renderLibrary(currentFilter);
  </script>
</body>
</html>