<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elite Crime & Espionage Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --bg-deep: #0a0a0c; --card-bg: #16161a; --accent: #e50914; --watched: #10b981; }
    body { background-color: var(--bg-deep); color: #e5e7eb; font-family: 'Inter', sans-serif; }
    .show-card { background: var(--card-bg); border: 1px solid #2d2d35; transition: transform 0.2s ease, border-color 0.2s ease; }
    .show-card:hover { border-color: var(--accent); transform: translateY(-4px); }
    .watched-badge { background-color: var(--watched); color: white; }
    .tag { background: #2d2d35; font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; }
    .trailer-thumb { aspect-ratio: 16 / 9; background-size: cover; background-position: center; background-color: #111; }
  </style>
</head>
<body class="p-4 md:p-8">

  <header class="max-w-6xl mx-auto mb-12 border-b border-gray-800 pb-8">
    <div class="flex flex-col md:flex-row md:justify-between md:items-end gap-4">
      <div>
        <h1 class="text-4xl md:text-5xl font-black tracking-tighter text-white mb-2 italic">THE LIBRARY.</h1>
        <p class="text-gray-400 text-lg">Curated Intelligence & High-Stakes European Crime.</p>
      </div>
      <div class="text-right">
        <p class="text-[10px] font-mono text-zinc-600 uppercase">Storage</p>
        <p id="storage-status" class="text-xs font-mono text-zinc-400">Local (this browser)</p>
      </div>
    </div>
    <div class="flex flex-wrap gap-4 mt-6">
      <span class="flex items-center gap-2 text-sm">
        <div id="legend-series-dot" class="w-3 h-3 rounded-full bg-gray-600"></div>
        <span>Series</span>
      </span>
      <span class="flex items-center gap-2 text-sm">
        <div id="legend-movies-dot" class="w-3 h-3 rounded-full bg-gray-600"></div>
        <span>Movies</span>
      </span>
    </div>
  </header>

  <div class="max-w-6xl mx-auto mb-4 flex flex-wrap gap-2">
    <button onclick="window.filterContent('all')" id="btn-all" class="px-4 py-2 bg-white text-black font-bold rounded-md transition">All</button>
    <button onclick="window.filterContent('unseen')" id="btn-unseen" class="px-4 py-2 bg-zinc-800 text-white font-bold rounded-md hover:bg-zinc-700 transition">Unwatched</button>
    <button onclick="window.filterContent('watched')" id="btn-watched" class="px-4 py-2 bg-zinc-800 text-white font-bold rounded-md hover:bg-zinc-700 transition">Watched</button>
    <button onclick="window.filterContent('type-series')" id="btn-type-series" class="px-4 py-2 bg-zinc-800 text-white font-bold rounded-md hover:bg-zinc-700 transition">Series</button>
    <button onclick="window.filterContent('type-movie')" id="btn-type-movie" class="px-4 py-2 bg-zinc-800 text-white font-bold rounded-md hover:bg-zinc-700 transition">Movies</button>
  </div>
  
  <div class="max-w-6xl mx-auto mb-8 flex flex-wrap gap-2 items-center border-t border-zinc-800 pt-4">
    <button onclick="window.filterContent('sort-az')" class="px-3 py-1 text-xs bg-zinc-900 text-zinc-400 border border-zinc-700 rounded-md hover:text-white">Sort A-Z</button>
    <button onclick="window.filterContent('sort-za')" class="px-3 py-1 text-xs bg-zinc-900 text-zinc-400 border border-zinc-700 rounded-md hover:text-white">Sort Z-A</button>
    <button onclick="window.resetLibrary()" id="btn-reset" class="ml-auto px-4 py-2 bg-zinc-900 text-white font-bold rounded-md border border-zinc-700 hover:bg-zinc-800 text-sm">Reset (local)</button>
  </div>

  <main id="libraryGrid" class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></main>

  <script>
    const STORAGE_KEY = "elite_crime_library_v1";

    const slugify = (str) => String(str || "").toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)+/g, "");
    const clampPct = (n) => (typeof n !== "number" || Number.isNaN(n)) ? null : Math.max(0, Math.min(100, Math.round(n)));

    function getYTThumbById(id) {
      return id ? `https://img.youtube.com/vi/${id}/hqdefault.jpg` : "https://images.unsplash.com/photo-1533422902779-afd35862846a?w=800";
    }

    function getYTEmbedById(id) {
      return id ? `https://www.youtube.com/embed/${id}?autoplay=1&rel=0&cc_load_policy=1` : null;
    }

    const initialShows = [
        { name: "4 Blocks", about: "A German powerhouse about a Lebanese crime family in Berlin. Loyalty, territory, and survival collide as business and blood become indistinguishable.", watched: false, type: "Series", trailerId: "2m4ZblO6YlI" },
        { name: "Betrayal (ITV)", about: "Heavy-hitting British espionage thriller starring Shaun Evans. Perfect for fans of Homeland; focuses on high-stakes intelligence operation.", watched: false, type: "Series", trailerId: "NNtxHA1Lq9k" },
        { name: "Blinded by the Lights", about: "Polish series with visual style identical to ZeroZeroZero. Follows a cocaine dealer in Warsaw whose life unravels over one chaotic week.", watched: false, type: "Series", trailerId: "CVOaVn6iHkg" },
        { name: "Blood Coast", about: "Set in Marseille. Violent, high-paced, and captures the same 'uncontrollable city' vibe as Naples in Gomorrah.", watched: false, type: "Series", trailerId: "nEP2but7fAs" },
        { name: "Caliphate", about: "Swedish thriller depicting radicalisation and counter-terrorism on television with extreme intensity.", watched: false, type: "Series", trailerId: "UhXOhWVTpf8" },
        { name: "Dope Thief", about: "New 2025 series mirroring the gritty drug trade of ZeroZeroZero, following friends crossing a global narcotics enterprise.", watched: false, type: "Series", trailerId: "8C8y91N6QI0" },
        { name: "False Flag", about: "Israeli series where ordinary citizens are implicated in a Mossad kidnapping. High-tension tradecraft.", watched: false, type: "Series", trailerId: "Mc1_6zrC9d8" },
        { name: "Fauda", about: "IDF experience, tactical operations and the human cost of the Israeli-Palestinian conflict.", watched: true, type: "Series", trailerId: "wf_-X6ocMHI" },
        { name: "Gangs of London", about: "Visceral action set in modern London, capturing the violent pulse of multicultural organized crime.", watched: true, type: "Series", trailerId: "1yIPmz_3C20" },
        { name: "Gomorrah", about: "The ultimate mafia saga. It ignores the glamour to show the rotting nature of power in Naples.", watched: true, type: "Series", trailerId: "-4QORgagblU" },
        { name: "Homeland", about: "Modern classic. Early seasons provide the same 'who can you trust' tension found in elite spy thrillers.", watched: true, type: "Series", trailerId: "41RO1q9A4V4" },
        { name: "Iron Reign", about: "Barcelona shipping terminal as the heart of a global drug empire. Shows the logistics of the cartel.", watched: false, type: "Series", trailerId: "ql0oL-VIA_0" },
        { name: "Kin", about: "Irish drama focusing on the suffocating bonds of a Dublin crime family.", watched: true, type: "Series", trailerId: "_byGxUym7HQ" },
        { name: "Land of Sin", about: "Nordic Noir following an investigator looking into a dark family feud in the Swedish countryside.", watched: false, type: "Series", trailerId: "hujjUJmpJxE" },
        { name: "Love/Hate", about: "The 'Irish Gomorrah' focusing on the Dublin criminal underworld. Hard-hitting realism.", watched: false, type: "Series", trailerId: "GpQqMVV4S40" },
        { name: "Manayek", about: "Focuses on internal corruption within the Israeli police. Cynical and grounded like the best crime epics.", watched: false, type: "Series", trailerId: "moCib_EP0ww" },
        { name: "Mobland", about: "Brutal clash between mob families. Anchored by heavyweights Tom Hardy and Pierce Brosnan.", watched: true, type: "Movie", trailerId: "84ekA0PaodY" },
        { name: "Mocro Maffia", about: "High brutality following Moroccan-Dutch gangs in Amsterdam. Intense territory wars.", watched: false, type: "Series", trailerId: "kDaOerOLlQE" },
        { name: "Narco-Saints", about: "Businessman pulled into a mission to take down a drug lord in Suriname. Based on a true story.", watched: false, type: "Series", trailerId: "F-5RFGWXt3E" },
        { name: "Romanzo Criminale", about: "Legendary Italian series tracking the rise of a powerful criminal gang in 1970s Rome.", watched: false, type: "Series", trailerId: "gNwQW-Kptsc" },
        { name: "Salvador (Netflix)", about: "Gritty Spanish crime series featuring Leonor Watling. A must for fans of European underworld drama.", watched: false, type: "Series", trailerId: "enYxVohkApA" },
        { name: "Slow Horses", about: "MI5 'rejects' who find themselves at the centre of conspiracies. Cynical British intelligence.", watched: false, type: "Series", trailerId: "O9ZJChzPn0U" },
        { name: "Snabba Cash", about: "Swedish series blending high-flying tech startups with the brutal reality of gang-led drug trafficking.", watched: false, type: "Series", trailerId: "yHFBsGdIBzs" },
        { name: "Suburra Blood on Rome", about: "Italian thriller focusing on the intersection of the mafia, corrupt politicians, and the Vatican.", watched: true, type: "Series", trailerId: "AYwpxrt7ZLA" },
        { name: "Tehran", about: "Mossad hacker stranded in Iran. Tactical espionage with extremely high stakes.", watched: false, type: "Series", trailerId: "Dmt9tvnFatQ" },
        { name: "The Agency", about: "Deep-cover tradecraft and intense, global-reaching espionage. Remake of The Bureau.", watched: false, type: "Series", trailerId: "42AUSELr1YM" },
        { name: "The Americans", about: "Drama about KGB spies in 1980s America. Captures constant paranoia and identity conflict.", watched: false, type: "Series", trailerId: "Cji8AUsEBMc" },
        { name: "The Bureau", about: "Masterpiece about deep-cover agents focusing on tradecraft and psychological realism.", watched: false, type: "Series", trailerId: "1Jgli7eQytI" },
        { name: "The Chestnut Man", about: "Moody Danish Nordic Noir thriller. Intense investigation in Copenhagen based on the bestseller.", watched: false, type: "Series", trailerId: "7VoNqbvMYdc" },
        { name: "The Day of the Jackal", about: "Polished European thriller following a high-stakes cat-and-mouse game across the continent.", watched: true, type: "Series", trailerId: "d9iD-UUL9SA" },
        { name: "The Hunter", about: "Sicily prosecutor taking on the Corleonesi Mafia in the 90s. True story realism.", watched: false, type: "Series", trailerId: "NjHAbIz9BqE" },
        { name: "The Immortal", about: "Cinematic bridge for the Gomorrah universe exploring Ciro Di Marzio's tragic origin story.", watched: true, type: "Movie", trailerId: "fuNcrRMkwtQ" },
        { name: "The Night Manager", about: "Hotel manager infiltrates the inner circle of a dangerous international arms dealer.", watched: false, type: "Series", trailerId: "0EZAXmCDgYE" },
        { name: "The Spy", about: "Sacha Baron Cohen portrays Eli Cohen in this true story of a Mossad agent in Syria.", watched: true, type: "Series", trailerId: "5UijUOy0MmE" },
        { name: "This City Is Ours", about: "Disintegration of a crime leader as his retirement triggers a violent power vacuum.", watched: true, type: "Series", trailerId: "9irsgS7DEUI" },
        { name: "Top Boy", about: "Intimate portrayal of inner-city gang life and the personal cost of the drug trade in the UK.", watched: false, type: "Series", trailerId: "1bg9SAljqIM" },
        { name: "Valley of Tears", about: "Visceral depiction of the 1973 Yom Kippur War. Raw military intensity.", watched: false, type: "Series", trailerId: "ltSvPE8xw3A" },
        { name: "ZeroZeroZero", about: "A global look at the logistics of crime, following a single shipment across three continents.", watched: true, type: "Series", trailerId: "3HoRfUKcvdY" }
    ];

    let currentFilter = "all", shows = [], editingId = null, playingId = null;
    const expandedIds = new Set();
    window.editDraft = {};

    function loadShows() {
      const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "null");
      return (Array.isArray(saved) && saved.length) ? saved.map(normalizeShow) : initialShows.map(normalizeShow);
    }

    function saveShows(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      const el = document.getElementById("storage-status");
      if (el) { el.textContent = "Saved locally"; setTimeout(() => el.textContent = "Local (this browser)", 900); }
    }

    function normalizeShow(s) {
      const name = String(s?.name ?? "");
      return { id: s?.id || slugify(name), name, about: String(s?.about ?? ""), watched: Boolean(s?.watched), type: String(s?.type ?? "Series"), trailerId: String(s?.trailerId || ""), noShitPct: clampPct(s?.noShitPct), rtPct: clampPct(s?.rtPct) };
    }

    function updateLegend(filter) {
      const s = document.getElementById("legend-series-dot"), m = document.getElementById("legend-movies-dot");
      if (!s || !m) return;
      const on = "bg-green-500", off = "bg-gray-600";
      s.classList.remove(on, off); m.classList.remove(on, off);
      if (filter === "type-series") { s.classList.add(on); m.classList.add(off); }
      else if (filter === "type-movie") { s.classList.add(off); m.classList.add(on); }
      else { s.classList.add(on); m.classList.add(on); }
    }

    window.toggleWatched = (id) => { const show = shows.find(s => s.id === id); if (show) { show.watched = !show.watched; saveShows(shows); renderLibrary(currentFilter); } };
    window.startEdit = (id) => { playingId = null; editingId = id; const show = shows.find(s => s.id === id); window.editDraft = { noShitPct: show.noShitPct, rtPct: show.rtPct }; renderLibrary(currentFilter); };
    window.cancelEdit = () => { editingId = null; window.editDraft = {}; renderLibrary(currentFilter); };
    window.saveEdit = (id) => { const show = shows.find(s => s.id === id); if (show) { show.noShitPct = clampPct(Number(window.editDraft.noShitPct)); show.rtPct = clampPct(Number(window.editDraft.rtPct)); saveShows(shows); } editingId = null; renderLibrary(currentFilter); };
    window.toggleAbout = (id) => { expandedIds.has(id) ? expandedIds.delete(id) : expandedIds.add(id); renderLibrary(currentFilter); };
    
    window.filterContent = (f) => { 
        playingId = null; 
        if (f === 'sort-az') { shows.sort((a, b) => a.name.localeCompare(b.name)); f = currentFilter; }
        else if (f === 'sort-za') { shows.sort((a, b) => b.name.localeCompare(a.name)); f = currentFilter; }
        else { currentFilter = f; }
        renderLibrary(currentFilter); 
    };

    window.resetLibrary = () => { if(confirm("Reset local library?")) { localStorage.removeItem(STORAGE_KEY); shows = initialShows.map(normalizeShow); renderLibrary(currentFilter); } };

    function renderLibrary(filter = "all") {
      updateLegend(filter);
      const grid = document.getElementById("libraryGrid");
      grid.innerHTML = "";
      ["all", "unseen", "watched", "type-series", "type-movie"].forEach(f => {
        const btn = document.getElementById(`btn-${f}`);
        if (btn) btn.className = `px-4 py-2 font-bold rounded-md transition ${f === filter ? 'bg-white text-black' : 'bg-zinc-800 text-white hover:bg-zinc-700'}`;
      });

      shows.forEach(show => {
        if (filter === "unseen" && show.watched) return;
        if (filter === "watched" && !show.watched) return;
        if (filter === "type-series" && show.type !== "Series") return;
        if (filter === "type-movie" && show.type !== "Movie") return;
        
        const isEditing = editingId === show.id;
        grid.innerHTML += `
          <div class="show-card rounded-xl overflow-hidden group">
            <div class="trailer-thumb relative" style="background-image: url('${getYTThumbById(show.trailerId)}')">
              ${playingId === show.id ? `<iframe src="${getYTEmbedById(show.trailerId)}" class="absolute inset-0 w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><button onclick="playingId=null;renderLibrary(currentFilter)" class="absolute top-3 right-3 bg-black/60 text-white text-xs px-3 py-1 rounded-full">Close</button>` : `
                <div class="absolute inset-0 bg-black/50 group-hover:bg-black/30 transition-all"></div>
                ${show.watched ? `<div class="absolute top-3 right-3 watched-badge px-3 py-1 rounded-full text-[10px] font-bold uppercase">WATCHED</div>` : ""}
                <div class="absolute inset-0 flex items-center justify-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button onclick="playingId='${show.id}';renderLibrary(currentFilter)" class="w-14 h-14 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center border border-white/40 hover:bg-white/40 transition"><div class="w-0 h-0 border-t-[10px] border-t-transparent border-l-[14px] border-l-white border-b-[10px] border-b-transparent ml-1"></div></button>
                  <button onclick="window.toggleWatched('${show.id}')" class="w-12 h-12 bg-zinc-800/80 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 hover:bg-zinc-700 transition"><svg class="w-6 h-6" style="color: ${show.watched ? 'var(--watched)' : '#ffffff'}" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg></button>
                </div>
              `}
            </div>
            <div class="p-6">
              <span class="tag">${show.type}</span>
              <h3 class="text-xl font-bold text-white my-2 leading-tight">${show.name}</h3>
              <p class="text-gray-400 text-sm leading-relaxed ${expandedIds.has(show.id) ? '' : 'h-[72px] overflow-hidden'}">${show.about}</p>
              ${show.about.length > 130 ? `<button onclick="window.toggleAbout('${show.id}')" class="mt-2 text-[10px] font-mono uppercase text-zinc-400 hover:text-white">${expandedIds.has(show.id) ? 'Less' : 'More'}</button>` : ''}
              <div class="mt-4 text-xs font-mono text-zinc-400">
                ${isEditing ? `<div class="flex items-center gap-2"><input type="number" value="${show.noShitPct ?? ''}" oninput="window.editDraft.noShitPct=this.value" class="w-16 bg-zinc-900 border border-zinc-700 rounded px-1 text-white" placeholder="%" /><input type="number" value="${show.rtPct ?? ''}" oninput="window.editDraft.rtPct=this.value" class="w-16 bg-zinc-900 border border-zinc-700 rounded px-1 text-white ml-2" placeholder="%" /><button onclick="window.saveEdit('${show.id}')" class="text-green-400">Save</button><button onclick="window.cancelEdit()" class="text-zinc-500 ml-2">Cancel</button></div>` : `
                  <span>No Shit: ${show.noShitPct ?? '—'}%</span> <span class="ml-3">RT: ${show.rtPct ?? '—'}%</span>
                  <button onclick="window.startEdit('${show.id}')" class="ml-4 hover:text-white">Edit</button>
                `}
              </div>
            </div>
          </div>`;
      });
    }

    shows = loadShows();
    renderLibrary(currentFilter);
  </script>
</body>
</html>